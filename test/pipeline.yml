jobs:
- name: test
  plan:
  - aggregate:
    - get: stemcell
    - get: bosh-deployment
    - get: bucc-ci
  - put: cloud-config
    params:
      manifest: bosh-deployment/warden/cloud-config.yml
      releases: []
  - put: deploy
    params:
      no_redact: true
      manifest: bosh-deployment/bosh.yml
      stemcells: [ stemcell/stemcell.tgz ]
      ops_files: [ bosh-deployment/misc/bosh-dev.yml, bucc-ci/tasks/warden-cpi.yml ]
      vars: { internal_ip: 10.244.0.34, director_name: inception }

resources:
  - name: bucc-ci
    type: git
    source:
      uri: https://github.com/starkandwayne/bucc.git
      branch: pipeline-test
      paths: [test/*]
      disable_ci_skip: true


- name: bosh-deployment
  type: git
  source:
    uri: https://github.com/cloudfoundry/bosh-deployment.git
    branch: master

- name: stemcell
  type: bosh-io-stemcell
  source:
    # we can update this value in the in the ci/get-latest-bosh-deployment
    # grep version src/bosh-deployment/misc/bosh-dev.yml | sed 's/[^0-9.]*\([0-9.]*\).*/\1/'
    name: bosh-warden-boshlite-ubuntu-trusty-go_agent
    version_family: "3445.7"

- name: deploy
  type: bosh-deployment
  source:
    <<: *deployment
    <<: *bosh_env

- name: cloud-config
  type: bosh-config
  source:
    type: cloud-config
    <<: *bosh_env

params:
  bosh_env: &bosh_env
    target: ((bosh_environment))
    client: ((bosh_client))
    client_id: ((bosh_client))
    client_secret: ((bosh_client_secret))
    ca_cert: ((bosh_ca_cert))
  deployment: &deployment
    deployment: bosh

resource_types:
- name: bosh-config
  type: docker-image
  source: { repository: rkoster/bosh-config-resource }

- name: bosh-deployment
  type: docker-image
  source: { repository: cloudfoundry/bosh-deployment-resource }
